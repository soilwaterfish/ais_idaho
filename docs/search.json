[{"path":"https://github.com/soilwaterfish/aisrisk/articles/final_scores.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Final Scores","text":"report covers methods used generate Aquatic Invasive Species (AIS) prioritization Idaho specifically Nez-Perce/Clearwater Idaho Panhandle National Forests. used methods described Montana Fish, Wildlife Parks AIS prioritization lotic lentic environments best . input data difficult retrieve due lack collection various sources, thus data gaps likely help methods.","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/final_scores.html","id":"social-suitability-score-criteria","dir":"Articles","previous_headings":"","what":"Social Suitability Score Criteria","title":"Final Scores","text":"Social Suitability Score broken 5 different indicators potential risk invasion via social players. factors stratified categories 1-4 based different thresholds (see Tables ). scores used final risk score adding Habitat Suitability Score.  Waterbody Type - simply breaking waters risk large lakes risk small streams less risk. Waterbody Size - surrogate recreation based idea longer river larger lake typically see recreational use. Position Watershed - Position watershed highlights areas lower watershed typically going risk AIS due accessibility downstream waterways. Mussel Proximity - distance nearest invasive mussel populations via road network. Angler Days - days anglers fishing higher days mean higher risk. Waterbody Type Waterbody Size Position Watershed Mussel Proximity Angler Days       Still need figure mussel proximity. Still need figure angler days.","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/final_scores.html","id":"habitat-suitability-score","dir":"Articles","previous_headings":"","what":"Habitat Suitability Score","title":"Final Scores","text":"Habitat Suitability Score broken 6 different indicators potential risk invasion via physical conditions. factors stratified categories 1-4 based different thresholds (see Tables ). scores used final risk score adding Social Suitability Score. note, large data gap variables (calcium, dissolved oxygen, hardness), likely effect overall score since missing data. data gap leads low score, might , structurally biased since scores additive.  Water Temperature - breaks water different levels risk based stream temperature. total 28,059 streams temperature data used model. pH - surrogate recreation based idea longer river larger lake typically see recreational use. Hardness - Position watershed highlights areas lower watershed typically going risk AIS due accessibility downstream waterways. Calcium - distance nearest invasive mussel populations via road network. Conductivity - days anglers fishing higher days mean higher risk. Dissolved Oxygen - days anglers fishing higher days mean higher risk.  Stream Temperature pH Hardness Calcium Conductivity Dissolved Oxygen","code":"## Warning: Removed 1 rows containing missing values (`position_stack()`)."},{"path":"https://github.com/soilwaterfish/aisrisk/articles/hss.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Habitat Suitability Score Criteria - GIS ","text":"GIS workflow covers social suitability methods used generate Aquatic Invasive Species (AIS) prioritization Idaho specifically Nez-Perce/Clearwater Idaho Panhandle National Forests. used methods described Montana Fish, Wildlife Parks AIS prioritization lotic lentic environments best .","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/sssc.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Social Suitability Score Criteria - GIS ","text":"GIS workflow covers social suitability methods used generate Aquatic Invasive Species (AIS) prioritization Idaho specifically Nez-Perce/Clearwater Idaho Panhandle National Forests. used methods described Montana Fish, Wildlife Parks AIS prioritization lotic lentic environments best .","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/sssc.html","id":"methods","dir":"Articles","previous_headings":"Overview","what":"Methods","title":"Social Suitability Score Criteria - GIS ","text":"methods used generate social suitability scores involve GIS processing R /Python (eventually implementing). challenging part necessarily geospatial analysis instead getting data work relate together, e.g. waterbodies streams/rivers. first part vignette go logic used waterbody type, size, position link together using Hydrological Unit Codes (HUC) National Hydrography Dataset Plus Version 2 (NHDPlus V2). follow mussel proximity workflow using road network find far away recently (2023, Snake River near Twin Falls, Idaho) found mussel population waterbodies streams/rivers. angler data proxy variable right now left analysis. goal vignette show steps took get figure output . {aisrisk} package abstracts away steps functions real meat workflow created.","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/sssc.html","id":"data","dir":"Articles","previous_headings":"Overview > Methods","what":"Data","title":"Social Suitability Score Criteria - GIS ","text":"’ll need waterbodies, flowlines HUC 12’s Idaho via NDHPLus V2. can retrieved various sources retrieved via thr nhdplusTools package R. waterbodies flowlines contain two different geometry types: POLYLINE (flowlines) MULTIPOLYGON (waterbodies). aware bringing together end final score things done certain ways.","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/sssc.html","id":"waterbody-type","dir":"Articles","previous_headings":"Overview > Methods","what":"Waterbody Type","title":"Social Suitability Score Criteria - GIS ","text":"Waterbody type calculated using NHDPlus dataset associated attribute streamorder (Strahler) streams rivers acreage waterbodies.","code":"library(sf) library(tidyverse)  #### waterbodies_idaho and nhdplus_idaho are datasets retrieved prior to doing calculations....  waterbodies_idaho <- read_sf('data/simple_features.gpkg', layer = 'waterbodies_idaho') nhdplus_idaho <- read_sf('data/simple_features.gpkg', layer = 'nhdplus_idaho')   waterbodies_idaho <- waterbodies_idaho %>%                        mutate(area_acres = as.numeric(units::set_units(sf::st_area(.), 'acres')),                              waterbody_type = if_else(area_acres<25, 3, 4)                               )  nhdplus_idaho <- nhdplus_idaho %>%                       mutate(waterbody_type = if_else(streamorde <= 3,1,                                                  if_else(streamorde >3 & streamorde <=5 , 2, 4)))"},{"path":"https://github.com/soilwaterfish/aisrisk/articles/sssc.html","id":"waterbody-size","dir":"Articles","previous_headings":"Overview > Methods","what":"Waterbody Size","title":"Social Suitability Score Criteria - GIS ","text":"Waterbody size used proxy recreation idea larger waterbodies rivers attract use. ’ll use datasets used Waterbody Type, calculate qts quartiles waterbody part group flowlines name get lengths. Get quartiles waterbodies. Get length flowlines based gnis_name; meaning flowlines names connected length.","code":"### waterbody size  qts <- quantile(waterbodies_idaho$area_acres)  waterbodies_idaho <- waterbodies_idaho %>% mutate(waterbody_size_rec = if_else(area_acres < qts[[2]], 1,                                                                       if_else(area_acres >= qts[[2]] & area_acres < qts[[3]], 2,                                                                               if_else(area_acres >= qts[[3]] & area_acres < qts[[4]], 3, 4))))  nhdplus_idaho <- nhdplus_idaho %>%                   rowwise() %>%                   mutate(gnis_name = if_else(gnis_name == ' ', as.character(paste0(paste0(sample(letters, 4), collapse = ''), '_', sample(1:100000000, 1))), gnis_name)) %>%                   group_by(gnis_name) %>%                   mutate(dist = sum(lengthkm)) %>%                   ungroup() %>%                   mutate(waterbody_size_rec = if_else(dist < 15, 1,                                                       if_else(dist >= 15 & dist < 30, 2,                                                               if_else(dist >= 30 & dist < 60, 3, 4))))"},{"path":"https://github.com/soilwaterfish/aisrisk/articles/sssc.html","id":"waterbody-position","dir":"Articles","previous_headings":"Overview > Methods","what":"Waterbody Position","title":"Social Suitability Score Criteria - GIS ","text":"Waterbody position little trickier waterbodies (lakes) flowlines. really isn’t great way differentiate two besides elevation, fully populated waterbodies dataset. account mountain lake reservoir (score 3), just took elevation waterbodies centroid available andand value larger lake likely lowland. definitely perfect, works .","code":"# from visual inspection we can see that lakes with > 300 acres are likely lowland waterbodies  waterbodies_idaho <- waterbodies_idaho %>%                          mutate(waterbody_position = if_else(area_acres > 300, 4, NA_real_))  # now get elevations for the ones that are below 300  waterbodies_idaho_filtered <- waterbodies_idaho %>%                              filter(is.na(waterbody_position)) %>%                              st_centroid() %>%                             select(-elevation) %>%                             elevatr::get_elev_point()  waterbodies_idaho_filtered <- bind_cols( waterbodies_idaho %>% filter(is.na(waterbody_position)) %>%                                           select(id, comid) %>% st_drop_geometry(),                                          waterbodies_idaho_filtered %>% select(ele = 'elevation') %>%                                           st_drop_geometry())  # then join back with original  ### just visually looked at the patterns and most valleys are below 1600 and high mountain lake are above  waterbodies_idaho <- waterbodies_idaho %>%                       left_join(waterbodies_idaho_filtered) %>%                       mutate(waterbody_position = ifelse(!is.na(waterbody_position), waterbody_position,                                                          ifelse(ele > 1500, 3, 4)))  nhdplus_idaho <- nhdplus_idaho %>%   mutate(waterbody_position = if_else(streamorde <= 2, 1,                                       if_else(streamorde > 2 & streamorde <=3, 2,                                           if_else(streamorde > 3 & streamorde <=5 , 3, 4))))"},{"path":"https://github.com/soilwaterfish/aisrisk/articles/sssc.html","id":"mussel-proximity","dir":"Articles","previous_headings":"Overview > Methods","what":"Mussel Proximity","title":"Social Suitability Score Criteria - GIS ","text":"Mussel proximity involves calculating distance via roadways nearest mussel population. Idaho Snake River near Twin Falls change updating important. workflow used create road network calculate cost distance affected area. First ’ll need roadnetwork cleaned. mean clean network multiples, loops, missing vertices crossing lines. ways ’d recommend using planarize tool ArcPro able quickly (need find R alternative). clean network, can start getting distances affected area (mussel_point). Depending CRS projection ’ll want adjust distances also final metric, miles case. Now network roads shortest path mussel location.  way link road network distances mussel_point find closest waterbody snap together. precise accurate way heavily intensive likely gaining much insight, .e. dealing miles. Thus, ’ll take HUC 12 road intersects use surrogate distance taking mean distances. can join back original datasets waterbodies_idaho nhdplus_idaho. help HUC 12 linked datasets distance also suitability score habitat. ’s perfect ’s flaws efficient way getting indicator score. Another issue getting road data can difficult. places show satellite imagery roads state government road layers . Finally, make complete need account areas NA’s within Forest Service land give 1 since likely wildnerness areas.","code":"library(sfnetworks) library(arcgis) library(purrr) library(tidygraph)  idaho <- AOI::aoi_get(stat = 'Idaho')  id_roads_sf <- arc_select(arc_open('https://gisportalp.itd.idaho.gov/xserver/rest/services/RH_GeneralService/MapServer/1/'))%>%   st_transform(3742)  ### this is because of an empty geometry; hopefully you won't have to deal with.... empty_geom <- id_roads_sf %>% st_geometry() %>% map(~is_empty(.x))  id_roads_sf$empty_geom <- unlist(empty_geom)  id_roads_sf <- id_roads_sf %>% filter(empty_geom == FALSE)  # you'll need to figure out how to get your usfs simple feature; here it was local for me.  usfs_roads <- read_sf('Z:/simple_features/roads/r1_rd_core.shp') %>% st_intersection(st_transform(idaho, st_crs(.)))%>%   st_transform(3742)  roads_together <- bind_rows(id_roads_sf%>% filter(SystemCode != 'FD'), usfs_roads) %>% st_as_sf() %>% st_cast('LINESTRING')  ########### Or bring in a clean version of the roads for your AOI ########  #roads_mt_id_clean <- read_sf('data/road_mt_id_fs.shp')  # get the mussel locations mussel_point <- mapedit::drawFeatures() %>% st_transform(crs = st_crs(usfs_roads))  # create a network and check for errors....   # set to conda env reticulate::use_condaenv(r'{C:\\Program Files\\ArcGIS\\Pro\\bin\\Python\\envs\\arcgispro-py3}')  arcpy <- reticulate::import('arcpy')  write_sf(roads_together, paste0(getwd(), '/data/together_roads.shp'))  arcpy$env$workspace = paste0(getwd(), '/data')  arcpy$CreateFileGDB_management(out_name = 'roads.gdb', out_folder_path = arcpy$env$workspace)  arcpy$FeatureToLine_management(in_features =  paste0(getwd(), '/data/together_roads.shp'), out_feature_class = 'roads.gdb/together_roads', cluster_tolerance = '5 Meters')  roads_together <- read_sf('data/roads.gdb', layer = 'together_roads') %>% st_cast(\"LINESTRING\")  # also convert to a crs that is good for north to south, etc. 3742 EPSG for Idaho UTM 12  net <- as_sfnetwork(roads_together, directed = FALSE) %>%   activate(\"edges\") %>%   mutate(weight = edge_length()) %>%   filter(!tidygraph::edge_is_multiple()) %>%   filter(!tidygraph::edge_is_loop()) # get the distances between the mussel_point and the nodes in the network  distances <- sfnetworks::st_network_cost(net, from = mussel_point, weights = 'weight')  # now get the 'from' in the network edged_start <- net %>% activate('edges') %>% pull(from)  # convert infinite to numeric net_final <- net %>%               activate('edges') %>%               mutate(new_weight = map(edged_start, ~as.numeric(if_else(is.infinite(distances[[.x]]), NA_real_, as.numeric(distances[[.x]])))))  # convert from meters to miles net_final_edges <- net_final %>% activate('edges') %>%                     mutate(new_weight = unlist(new_weight),                    new_weight = ifelse(is.infinite(new_weight), NA_real_, new_weight),                    new_weight_miles = as.numeric(new_weight*0.000621371)) %>%                     select(-new_weight) %>% st_as_sf() # adding huc12s and aggregating with a mean distance will make it easier for joining and not a lot of information lost  # now combined with HUCS to make easier.  huc12 <- read_sf('data/simple_features.gpkg', layer = 'huc12')  huc_list <- st_intersects(net_final_edges, st_transform(huc12, crs = st_crs(net_final_edges)))  huc_list <- map_vec(huc_list, ~ifelse(is.null(.x), NA, list(.x)))  huc12s <- huc12[huc_list,]$huc12  # now add back to the network net_final_edges$huc12 <- huc12s  distance_by_huc <- net_final_edges %>% group_by(huc12) %>% summarise(mean_dist = mean(new_weight_miles, na.rm = TRUE)) %>%    ungroup() %>% st_as_sf() %>% st_drop_geometry() %>% select(huc12, mean_dist)  distance_by_huc <- distance_by_huc %>% mutate(   mussel_proximity = case_when(     mean_dist > 400 ~ 1,     mean_dist > 300 & mean_dist <= 400 ~ 2,     mean_dist > 200 & mean_dist <= 300 ~ 3,     mean_dist <= 200 ~ 4,      TRUE ~ NA_real_   ) )  # Need to get centroid of lakes and then associated HUC12s  lake_list <- st_centroid(waterbodies_idaho) %>% st_intersects(huc12)  lake_list <- map_vec(lake_list, ~ifelse(is.null(.x), NA, .x))  huc12s <- huc12[lake_list,]$huc12  waterbodies_idaho$huc12 <- huc12s  # we'll need to get COMIDs and HUC12 codes  # download from online https://www.sciencebase.gov/catalog/item/57eaa10fe4b09082500db04e huc_comid <- read_sf(r'{Z:\\Downloads\\HUC12_PU_COMIDs_CONUS\\HUC12_PU_COMIDs_CONUS.dbf}') %>% janitor::clean_names()  nhdplus_idaho <- nhdplus_idaho %>% left_join(huc_comid %>% select(comid, huc12))  # now join back with the waterbodies and nhdplus datasets  nhdplus_idaho <- nhdplus_idaho %>% left_join(distance_by_huc, by = 'huc12')  waterbodies_idaho <- waterbodies_idaho %>% left_join(distance_by_huc, by = 'huc12') ### bring in your own admin units layer fs_lands <- read_sf('Z:/fisheries/btbaseline/data/bt_baseline.gpkg', layer = 'admin_units') %>% st_transform(crs = 4326)  npcw_idph <- fs_lands %>% filter(FORESTNAME %in% c('Nez Perce-Clearwater National Forest','Idaho Panhandle National Forests')) %>%   st_make_valid() %>% st_union()  ### get for nhdplus wild_water <- nhdplus_idaho %>% st_intersects(npcw_idph)  wild_water <- map_vec(wild_water, ~ifelse(is.null(.x), NA, .x))  nhdplus_idaho$fs_land <- wild_water  ### now for waterbodies  wild_water <- waterbodies_idaho %>% st_intersects(npcw_idph)  wild_water <- map_vec(wild_water, ~ifelse(is.null(.x), NA, .x))  waterbodies_idaho$fs_land <- wild_water   ### bring it all together nhdplus_idaho_final_social <- nhdplus_idaho %>% mutate(mussel_proximity = if_else(is.na(mussel_proximity) & fs_land == 1, 1, mussel_proximity))  waterbodies_idaho_final_social <- waterbodies_idaho %>% mutate(mussel_proximity = if_else(is.na(mussel_proximity) & fs_land == 1, 1, mussel_proximity))  waterbodies_idaho_final_social %>%    st_intersection(idaho) %>%    write_sf('data/simple_features.gpkg', layer = 'waterbodies_idaho_final_social', delete_layer = T)  nhdplus_idaho_final_social  %>%    st_intersection(idaho) %>%    write_sf('data/simple_features.gpkg', layer = 'nhdplus_idaho_final_social', delete_layer = T)"},{"path":"https://github.com/soilwaterfish/aisrisk/articles/test.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"test","text":"report covers methods used generate Aquatic Invasive Species (AIS) prioritization Idaho specifically Nez-Perce/Clearwater Idaho Panhandle National Forests. used methods described Montana Fish, Wildlife Parks AIS prioritization lotic lentic environments best . input data difficult retrieve due lack collection various sources, thus data gaps likely help methods.","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/test.html","id":"social-suitability-score-criteria","dir":"Articles","previous_headings":"Overview","what":"Social Suitability Score Criteria","title":"test","text":"Social Suitability Score broken 5 different indicators potential risk invasion via social players. factors stratified categories 1-4 based different thresholds (see Tables ). scores used final risk score adding Habitat Suitability Score.","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/test.html","id":"something","dir":"Articles","previous_headings":"Overview > Social Suitability Score Criteria","what":"something","title":"test","text":"laskjdf;lsakdjf;laksjd","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/test.html","id":"i-dont-know","dir":"Articles","previous_headings":"Overview > Social Suitability Score Criteria","what":"i don’t know","title":"test","text":";asdkjf;saldkj;aslk","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/articles/test.html","id":"new-stablkjs","dir":"Articles","previous_headings":"Overview","what":"NEw stablkjs","title":"test","text":"LSKjfglsdkjfl;sdkjf;lksjdfl;askd sdafsdafljsadlfkas df sadfjsdkalflsdakf","code":""},{"path":[]},{"path":"https://github.com/soilwaterfish/aisrisk/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Josh Erickson. Author, maintainer.","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Erickson J (2024). aisrisk: Model Risk Aquatic Invasive Species. R package version 0.1, https://soilwaterfish.github.io/aisrisk/.","code":"@Manual{,   title = {aisrisk: Model Risk for Aquatic Invasive Species},   author = {Josh Erickson},   year = {2024},   note = {R package version 0.1},   url = {https://soilwaterfish.github.io/aisrisk/}, }"},{"path":"https://github.com/soilwaterfish/aisrisk/index.html","id":"aisrisk","dir":"","previous_headings":"","what":"Model Risk for Aquatic Invasive Species","title":"Model Risk for Aquatic Invasive Species","text":"goal aisrisk …","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Model Risk for Aquatic Invasive Species","text":"can install development version aisrisk GitHub :","code":"# install.packages(\"devtools\") devtools::install_github(\"soilwaterfish/aisrisk\")"},{"path":"https://github.com/soilwaterfish/aisrisk/index.html","id":"example","dir":"","previous_headings":"","what":"Example","title":"Model Risk for Aquatic Invasive Species","text":"basic example shows solve common problem:","code":""},{"path":"https://github.com/soilwaterfish/aisrisk/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 aisrisk authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""}]
