<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="aisrisk">
<title>Habitat Suitability Score Criteria - GIS  • aisrisk</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Habitat Suitability Score Criteria - GIS ">
<meta property="og:description" content="aisrisk">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://www.fs.usda.gov/" class="external-link"><img src="https://www.fs.usda.gov/themes/custom/fs_uswds/logo.svg" id="hexlogo" alt="US Forest Service"></a>
    <a class="navbar-brand me-2" href="../index.html">aisrisk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--vignettes">
    <span class="fas fa fas fa-book"></span>
     
    Vignettes
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--vignettes">
    <a class="dropdown-item" href="../articles/final_scores.html">Final Scores</a>
    <a class="dropdown-item" href="../articles/sssc.html">Social Sutiability Score</a>
    <a class="dropdown-item" href="../articles/hss.html">Habitat Sutiability Score</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/soilwaterfish/aisrisk/">
    <span class="fa fa fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Habitat Suitability Score Criteria - GIS </h1>
            
      
      
      <div class="d-none name"><code>hss.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This is the GIS workflow that covers the habitat suitability methods
used to generate Aquatic Invasive Species (AIS) prioritization in Idaho
specifically the Nez-Perce/Clearwater and Idaho Panhandle National
Forests. We used methods described by Montana Fish, Wildlife and Parks
AIS prioritization for lotic and lentic environments to the best we
could.</p>
<p>In this vignette, there will be some steps that will take time to
process (~mins) and can take up a decent amount of memory (&gt; 1 Gb) so
please <em>be warned</em> before running the code below. Getting the
specific data with this model was difficult due to various metrics,
sources and collection history. This lead to a lot of areas lacking data
(see Figure below) and affecting the final model output. Eventually, the
idea is to bring in a Bayesian analysis framework to help with the
scattered data. For now, we will just stay with the existing
framework.</p>
<p>Again, our goal with the vignette is to show the steps it took to get
to the figure output below.</p>
<div class="figure">
<img src="www/images/habitat_final.png" alt="Final habitat scores for the six metrics. Notice there is a lot of missing data with certain metrics." width="250%"><p class="caption">
Final habitat scores for the six metrics. Notice there is a lot of
missing data with certain metrics.
</p>
</div>
<div class="section level4">
<h4 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h4>
<p>The data retrieval part of this model is very intensive and requires
some webscraping and http retrieval skills. There are three main sources
we are going to get data from;</p>
<ol style="list-style-type: decimal">
<li><p>(NorWest Stream Temperature)[<a href="https://www.fs.usda.gov/rm/boise/AWAE/projects/NorWeST.html" class="external-link uri">https://www.fs.usda.gov/rm/boise/AWAE/projects/NorWeST.html</a>].</p></li>
<li><p>(Water Quality Portal (WQP))[<a href="https://www.waterqualitydata.us/" class="external-link uri">https://www.waterqualitydata.us/</a>].</p></li>
<li><p>(Beneficial Use Reconnaissance Program (BURP))[<a href="https://www2.deq.idaho.gov/water/BurpViewer/" class="external-link uri">https://www2.deq.idaho.gov/water/BurpViewer/</a>].</p></li>
</ol>
<p>We’ll go through each step in getting the data and then bringing it
all together at the end. You’ll also need the
<code>nhdplus_idaho_final_social</code> and
<code>waterbody_idaho_final_social</code> data from the social vignette
at the very end to join it all together.</p>
</div>
<div class="section level4">
<h4 id="stream-temperature">Stream Temperature<a class="anchor" aria-label="anchor" href="#stream-temperature"></a>
</h4>
<p>To get the stream temperature data we’ll use NorWest modelled stream
temperature data for August (Isaak et al., 2017). We’ll get this via the
{fishguts} package and select appropriate watersheds, for more
information see <code><a href="https://rdrr.io/pkg/fishguts/man/get_NorWestStreams.html" class="external-link">?fishguts::get_NorWestStreams</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### bring in water temp from NorWest</span></span>
<span></span>
<span><span class="va">spokoot</span> <span class="op">&lt;-</span> <span class="fu">fishguts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fishguts/man/get_NorWestStreams.html" class="external-link">get_NorWestStreams</a></span><span class="op">(</span><span class="st">'SpoKoot'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cwb</span> <span class="op">&lt;-</span> <span class="fu">fishguts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fishguts/man/get_NorWestStreams.html" class="external-link">get_NorWestStreams</a></span><span class="op">(</span><span class="st">'Clearwater River Basin'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">srb</span> <span class="op">&lt;-</span> <span class="fu">fishguts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fishguts/man/get_NorWestStreams.html" class="external-link">get_NorWestStreams</a></span><span class="op">(</span><span class="st">'Salmon River Basin'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">middle_columbia</span> <span class="op">&lt;-</span> <span class="fu">fishguts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fishguts/man/get_NorWestStreams.html" class="external-link">get_NorWestStreams</a></span><span class="op">(</span><span class="st">'Middle Columbia'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">idaho</span> <span class="op">&lt;-</span> <span class="fu">AOI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AOI/man/aoi_get.html" class="external-link">aoi_get</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">'idaho'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stream_temp_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">spokoot</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">cwb</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">srb</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">middle_columbia</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stream_temp_id</span> <span class="op">&lt;-</span> <span class="va">stream_temp_id</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">idaho</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">stream_temp_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>What’s nice about this dataset is it’s linked to our other dataset
(<code>nhdplus_idaho</code>) by <code>comid</code>. Since there isn’t
any stream temperature associated with the NorWest Streams dataset and
waterbodies we tried to get some from both WQP and BURP; however, there
wasn’t any water temperature associated with waterbodies. There was
water temperature data that was collected with AIS monitoring in
previous years so we used that data to fill the gap within waterbodies
the best we could.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### create an empty list to put previous years data into </span></span>
<span></span>
<span><span class="va">monitorings_sites_quagga_zebra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-ArcGIS/arcgis/" class="external-link">arcgis</a></span><span class="op">)</span></span>
<span><span class="co"># loop through and call ESRI api</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="va">monitorings_sites_quagga_zebra</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">arc_select</span><span class="op">(</span><span class="fu">arc_open</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'https://gis.psmfc.org/server/rest/services/WesternAIS/Quagga_and_Zebra_Mussel_Monitoring_Sites/MapServer/'</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># clean up weird character geometries</span></span>
<span><span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">monitorings_sites_quagga_zebra</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">monitorings_sites_quagga_zebra_sf</span><span class="op">$</span><span class="va">geom_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">monitorings_sites_quagga_zebra_sf</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">.x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                                <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op">&lt;-</span> <span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geom_char</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op">&lt;-</span> <span class="va">monitorings_sites_quagga_zebra_sf</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_query.html" class="external-link">st_is_empty</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_zm.html" class="external-link">st_zm</a></span><span class="op">(</span><span class="va">monitorings_sites_quagga_zebra_sf</span><span class="op">)</span><span class="op">)</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># filter and clean up</span></span>
<span></span>
<span><span class="va">ais_list</span> <span class="op">&lt;-</span> <span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">idaho</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">monitorings_sites_quagga_zebra_sf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ais_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">ais_list</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># now we'll have each site within idaho</span></span>
<span></span>
<span><span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op">&lt;-</span> <span class="va">monitorings_sites_quagga_zebra_sf</span><span class="op">[</span><span class="va">ais_list</span>,<span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># you could really try and get as much as you can but </span></span>
<span><span class="co"># for our area the water temp is the most robust so we'll stick with that</span></span>
<span></span>
<span><span class="co"># clean up</span></span>
<span></span>
<span><span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op">&lt;-</span> <span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">WATERTEMPF</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>temperature_water <span class="op">=</span> <span class="st">'WATERTEMPF'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="water-quality-portal">Water Quality Portal<a class="anchor" aria-label="anchor" href="#water-quality-portal"></a>
</h4>
<p>You’ll need to access the WQP data to get the rest of the scores. I’d
recommend some sort of query call through an API or download via the
website. Below is a way to do this using the {dataRetrieval}
package.</p>
<p>This will take a while to download and also will take a decent amount
of space (&gt; Gb) so be aware before running!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we'll use these characteristic names to query the WQP</span></span>
<span></span>
<span><span class="va">wq_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                <span class="st">"pH"</span>, <span class="st">"Bicarbonate"</span>,                                              </span>
<span>                <span class="st">"Calcium"</span>, <span class="st">"Calcium carbonate"</span>,                                      </span>
<span>                <span class="st">"Hardness, Ca, Mg"</span>, <span class="st">"Dissolved oxygen saturation"</span>,                                </span>
<span>                <span class="st">"Dissolved oxygen (DO)"</span>, <span class="st">"Conductivity"</span>,                                               </span>
<span>                <span class="st">"Hardness, non-carbonate"</span>, <span class="st">"Alkalinity, carbonate"</span> ,                                     </span>
<span>                <span class="st">"Alkalinity, bicarbonate"</span>, <span class="st">"Hardness, magnesium"</span> ,                                       </span>
<span>                <span class="st">"Hardness, carbonate"</span>, <span class="st">"Total hardness"</span>,                                             </span>
<span>                <span class="st">"Alkalinity, Phenolphthalein (total hydroxide+1/2 carbonate)"</span>, <span class="st">"Specific conductivity"</span>,                                      </span>
<span>                <span class="st">"Hardness"</span>, <span class="st">"Calcium as CaCO3"</span> ,                                          </span>
<span>                <span class="st">"Alkalinity, Bicarbonate as CaCO3"</span></span>
<span>                <span class="op">)</span></span>
<span></span>
<span><span class="co"># Also, keep it to Idaho and within water.</span></span>
<span><span class="va">wqp_idaho</span> <span class="op">&lt;-</span> <span class="fu">dataRetrieval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readWQPdata.html" class="external-link">readWQPdata</a></span><span class="op">(</span>statecode <span class="op">=</span> <span class="st">'ID'</span>,</span>
<span>                                        characteristicName <span class="op">=</span> <span class="va">wq_names</span>,</span>
<span>                                        sampleMedia <span class="op">=</span> <span class="st">'Water'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### we'll use this to intersect the huc12s and waterbodies</span></span>
<span></span>
<span><span class="va">wqp_idaho_site_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">wqp_idaho</span>, <span class="st">'siteInfo'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wqp_idaho_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">wqp_idaho_site_info</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dec_lon_va</span><span class="op">)</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'dec_lon_va'</span>, <span class="st">'dec_lat_va'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now combined with HUCS to make easier.</span></span>
<span></span>
<span><span class="va">huc12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">'data/simple_features.gpkg'</span>, layer <span class="op">=</span> <span class="st">'huc12'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">huc_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="va">wqp_idaho_sf</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">huc12</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">wqp_idaho_sf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">huc_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_vec</a></span><span class="op">(</span><span class="va">huc_list</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now we'll have each site iwth a huc12 </span></span>
<span></span>
<span><span class="va">wqp_idaho_sf</span><span class="op">$</span><span class="va">huc12</span> <span class="op">&lt;-</span> <span class="va">huc12</span><span class="op">[</span><span class="va">huc_list</span>,<span class="op">]</span><span class="op">$</span><span class="va">huc12</span></span></code></pre></div>
<p>Before we move to the BURP data retrieval, we’ll clean up the WQP
data some more to remove some unwanted locations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wqp_idaho_filtered</span> <span class="op">&lt;-</span>   <span class="va">wqp_idaho</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ResultSampleFractionText</span>  <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Total'</span>, <span class="st">'Filtered, lab'</span><span class="op">)</span>,</span>
<span>                               <span class="va">ActivityMediaSubdivisionName</span> <span class="op">==</span> <span class="st">"Surface Water"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ResultMeasureValue <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html" class="external-link">parse_number</a></span><span class="op">(</span><span class="va">ResultMeasureValue</span><span class="op">)</span>,</span>
<span>                               ResultMeasureValue  <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">ResultMeasure.MeasureUnitCode</span>  <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ug/L'</span>, <span class="st">'ug/l'</span><span class="op">)</span>,</span>
<span>                                                             <span class="va">ResultMeasureValue</span><span class="op">*</span><span class="fl">0.001</span>, <span class="va">ResultMeasureValue</span><span class="op">)</span>,</span>
<span>                               ResultMeasure.MeasureUnitCode <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">ResultMeasure.MeasureUnitCode</span>  <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ug/L'</span>, <span class="st">'ug/l'</span><span class="op">)</span>,</span>
<span>                                                                       <span class="st">'mg/L'</span>,<span class="va">ResultMeasure.MeasureUnitCode</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/date.html" class="external-link">date</a></span><span class="op">(</span><span class="va">activity_start_date_time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">monitoring_location_identifier</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>result_measure_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_measure_value</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now add the huc12 id to join later with BURP, etc</span></span>
<span></span>
<span><span class="va">wqp_idaho_filtered</span> <span class="op">&lt;-</span> <span class="va">wqp_idaho_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wqp_idaho_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">huc12</span>,monitoring_location_identifier <span class="op">=</span> <span class="st">'MonitoringLocationIdentifier'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="burp">BURP<a class="anchor" aria-label="anchor" href="#burp"></a>
</h4>
<p>This is a very hacky-way to get a bunch of data off a website that
might not be possible otherwise.</p>
<p>The first step is to get the site ids from the BURP data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Now try and get the BURP data</span></span>
<span><span class="va">site_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1994</span><span class="op">:</span><span class="fl">2008</span>, <span class="fl">2010</span><span class="op">:</span><span class="fl">2023</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>      <span class="va">url_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'https://www2.deq.idaho.gov/water/BurpViewer/Menu?Year='</span>, <span class="va">i</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="va">url_sites</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">req_body</span> <span class="op">&lt;-</span> <span class="va">req</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="co"># get ids</span></span>
<span>      <span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">req_body</span><span class="op">$</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">keywords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>,<span class="st">"[A-Z0-9]+"</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">si</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">ids</span>, <span class="va">keywords</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">site_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">site_ids</span>, <span class="va">si</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># get the ids</span></span>
<span></span>
<span><span class="va">site_ids_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_unique.html" class="external-link">str_unique</a></span><span class="op">(</span><span class="va">site_ids</span><span class="op">)</span></span></code></pre></div>
<p>Step 2: create a function to scrape the html on the website lists and
table per site per year.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get info from ids</span></span>
<span></span>
<span><span class="va">burp_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>      <span class="va">url_streams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'https://www2.deq.idaho.gov/water/BurpViewer/BurpSite/Stream?BurpID='</span>, <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="va">url_streams</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">req_body</span> <span class="op">&lt;-</span> <span class="va">req</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">stream_html</span> <span class="op">&lt;-</span> <span class="va">req_body</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_html</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">stream_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">"//span[@class='readOnly']/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">labels</span> <span class="op">&lt;-</span> <span class="va">stream_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">"//div[@class='oneThird']/label/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">meta_label</span> <span class="op">&lt;-</span> <span class="va">stream_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">"//div[@id='leftCol']//ul/li/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">stream_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">"//div[@id='leftCol']//ul/li/strong/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">stream_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">"//div[@id='leftCol']//ul/li/strong/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        labels <span class="op">=</span> <span class="va">meta_label</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>        value <span class="op">=</span> <span class="va">meta</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>      <span class="va">url_location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'https://www2.deq.idaho.gov/water/BurpViewer/BurpSite/Location?BurpID='</span>, <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="va">url_location</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">req_body</span> <span class="op">&lt;-</span> <span class="va">req</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">location_html</span> <span class="op">&lt;-</span> <span class="va">req_body</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_html</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">values_loc</span> <span class="op">&lt;-</span> <span class="va">location_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">"//div[@class='half']//label/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">labels_loc</span> <span class="op">&lt;-</span> <span class="va">location_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">"//span[@class='readOnly']/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">site_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">labels</span>,</span>
<span>                          values <span class="op">=</span> <span class="va">values</span>,</span>
<span>                          sample_year <span class="op">=</span> <span class="va">md</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">$</span><span class="va">value</span>,</span>
<span>                          stream <span class="op">=</span> <span class="va">md</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span><span class="op">$</span><span class="va">value</span>,</span>
<span>                          assessment_unit <span class="op">=</span> <span class="va">md</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span><span class="op">$</span><span class="va">value</span>,</span>
<span>                          site_id <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">labels</span>, values_from <span class="op">=</span> <span class="va">values</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">location_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">labels_loc</span>,</span>
<span>                          values <span class="op">=</span> <span class="va">values_loc</span>,</span>
<span>                          site_id <span class="op">=</span> <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">values</span>, values_from <span class="op">=</span> <span class="va">labels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">site_info</span>, <span class="va">location_info</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Step 3: run this function in parallel and crawl all over that
webpage.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">site_ids_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html" class="external-link">future_map</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html" class="external-link">safely</a></span><span class="op">(</span><span class="op">~</span><span class="fu">burp_func</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">burp_final</span> <span class="op">&lt;-</span> <span class="va">test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="va">.x</span><span class="op">[[</span><span class="st">'result'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### now clean up and make a spatial copy</span></span>
<span></span>
<span><span class="va">burp_final_cleaned</span> <span class="op">&lt;-</span> <span class="va">burp_final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.x</span>  <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'No Data'</span>, <span class="st">'NA m'</span>, <span class="st">' '</span>, <span class="st">''</span>, <span class="st">'mg/l'</span><span class="op">)</span>, <span class="cn">NA_real_</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">air_temperature</span><span class="op">:</span><span class="va">total_reach_length</span>, <span class="va">stream_order</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html" class="external-link">parse_number</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">latitude</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>         <span class="va">site_id</span> <span class="op">!=</span> <span class="st">'2001SPOCA029'</span>,</span>
<span>         <span class="va">p_h</span> <span class="op">&lt;</span> <span class="fl">15</span>,</span>
<span>         <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">burp_final_cleaned_sf</span> <span class="op">&lt;-</span> <span class="va">burp_final_cleaned</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'longitude'</span>, <span class="st">'latitude'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#now intersect with huc12</span></span>
<span></span>
<span><span class="va">huc_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="va">burp_final_cleaned_sf</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">huc12</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">burp_final_cleaned_sf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">huc_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_vec</a></span><span class="op">(</span><span class="va">huc_list</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now we'll have each site iwth a huc12 </span></span>
<span></span>
<span><span class="va">burp_final_cleaned_sf</span><span class="op">$</span><span class="va">huc12</span> <span class="op">&lt;-</span> <span class="va">huc12</span><span class="op">[</span><span class="va">huc_list</span>,<span class="op">]</span><span class="op">$</span><span class="va">huc12</span></span>
<span></span>
<span><span class="co"># write if need be...</span></span>
<span></span>
<span><span class="co"># write_csv(burp_final_cleaned, 'data/burp_sites_cleaned_1994-2023.csv')</span></span>
<span><span class="co"># write_sf(burp_final_cleaned_sf, 'data/simple_features.gpkg', layer = 'burp_final_cleaned_sf')</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="bring-it-all-together">Bring it all together<a class="anchor" aria-label="anchor" href="#bring-it-all-together"></a>
</h4>
<p>Finally! We can now start to bring it all together.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wqp_idaho_filtered_summarized</span> <span class="op">&lt;-</span> <span class="va">wqp_idaho_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">characteristic_name</span>, <span class="va">result_measure_value</span>,</span>
<span>                                        <span class="va">monitoring_location_identifier</span>, <span class="va">huc12</span>, </span>
<span>                                        <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">'characteristic_name'</span>,</span>
<span>                                             values_from <span class="op">=</span> <span class="st">'result_measure_value'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">huc12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">p_h</span><span class="op">:</span><span class="va">hardness_non_carbonate</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">huc12</span>,</span>
<span>                                        <span class="va">p_h</span>,</span>
<span>                                        <span class="va">calcium</span>,</span>
<span>                                        <span class="va">conductivity</span>,</span>
<span>                                        <span class="va">temperature_water</span>,</span>
<span>                                        hardness <span class="op">=</span> <span class="st">'hardness_ca_mg'</span>, </span>
<span>                                        dissolved_oxygen <span class="op">=</span> <span class="st">'dissolved_oxygen_do'</span><span class="op">)</span></span>
<span>                                 </span>
<span><span class="co"># now do the same with the BURP data</span></span>
<span></span>
<span><span class="va">burp_final_cleaned_summarized</span> <span class="op">&lt;-</span> <span class="va">burp_final_cleaned_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">huc12</span>, <span class="va">conductivity</span><span class="op">:</span><span class="va">dissolved_oxygen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">huc12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">conductivity</span><span class="op">:</span><span class="va">dissolved_oxygen</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span>                                </span>
<span>                                 </span>
<span><span class="co"># now bind together and group summarize by huc12</span></span>
<span></span>
<span><span class="va">all_together_burp_wqp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">wqp_idaho_filtered_summarized</span>, <span class="va">burp_final_cleaned_summarized</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">huc12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now we can do a long if/else</span></span>
<span></span>
<span><span class="va">final_ish_model</span> <span class="op">&lt;-</span> <span class="va">all_together_burp_wqp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    p_h_model <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">p_h</span> <span class="op">&lt;=</span> <span class="fl">3.9</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">p_h</span> <span class="op">&lt;=</span> <span class="fl">5.4</span><span class="op">~</span> <span class="fl">2</span>,</span>
<span>    <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">5.5</span> <span class="op">&amp;</span> <span class="va">p_h</span> <span class="op">&lt;=</span> <span class="fl">6.9</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>    <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">p_h</span> <span class="op">&lt;=</span> <span class="fl">9.9</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>    <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">p_h</span> <span class="op">&lt;=</span> <span class="fl">11</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>    <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">11</span> <span class="op">&amp;</span> <span class="va">p_h</span> <span class="op">&lt;=</span> <span class="fl">13</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>    <span class="va">p_h</span> <span class="op">&gt;</span> <span class="fl">13</span> <span class="op">&amp;</span> <span class="va">p_h</span> <span class="op">&lt;=</span> <span class="fl">14</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span>,</span>
<span>    calcium_model <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">calcium</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">calcium</span> <span class="op">&lt;=</span> <span class="fl">4</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">calcium</span> <span class="op">&gt;</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">calcium</span> <span class="op">&lt;=</span> <span class="fl">13</span><span class="op">~</span> <span class="fl">2</span>,</span>
<span>    <span class="va">calcium</span> <span class="op">&gt;</span> <span class="fl">13</span> <span class="op">&amp;</span> <span class="va">calcium</span> <span class="op">&lt;=</span> <span class="fl">24</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>    <span class="va">calcium</span> <span class="op">&gt;</span> <span class="fl">24</span> <span class="op">&amp;</span> <span class="va">calcium</span> <span class="op">&lt;=</span> <span class="fl">100</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span>,</span>
<span>    hardness_model <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">hardness</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">hardness</span> <span class="op">&lt;=</span> <span class="fl">50</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">hardness</span> <span class="op">&gt;</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">hardness</span> <span class="op">&lt;=</span> <span class="fl">99</span><span class="op">~</span> <span class="fl">2</span>,</span>
<span>    <span class="va">hardness</span> <span class="op">&gt;</span> <span class="fl">99</span> <span class="op">&amp;</span> <span class="va">hardness</span> <span class="op">&lt;=</span> <span class="fl">125</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>    <span class="va">hardness</span> <span class="op">&gt;</span> <span class="fl">125</span> <span class="op">&amp;</span> <span class="va">hardness</span> <span class="op">&lt;=</span> <span class="fl">1000</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span>,</span>
<span>    do_model <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">dissolved_oxygen</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">dissolved_oxygen</span> <span class="op">&lt;=</span> <span class="fl">3</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">dissolved_oxygen</span> <span class="op">&gt;</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">dissolved_oxygen</span> <span class="op">&lt;=</span> <span class="fl">7</span><span class="op">~</span> <span class="fl">2</span>,</span>
<span>    <span class="va">dissolved_oxygen</span> <span class="op">&gt;</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">dissolved_oxygen</span> <span class="op">&lt;=</span> <span class="fl">12</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>    <span class="va">dissolved_oxygen</span> <span class="op">&gt;</span> <span class="fl">12</span> <span class="op">&amp;</span> <span class="va">dissolved_oxygen</span> <span class="op">&lt;=</span> <span class="fl">50</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span>,</span>
<span>    conductivity_model <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">conductivity</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">conductivity</span> <span class="op">&lt;=</span> <span class="fl">490</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">conductivity</span> <span class="op">&gt;</span> <span class="fl">490</span> <span class="op">&amp;</span> <span class="va">conductivity</span> <span class="op">&lt;=</span> <span class="fl">989</span><span class="op">~</span> <span class="fl">2</span>,</span>
<span>    <span class="va">conductivity</span> <span class="op">&gt;</span> <span class="fl">989</span> <span class="op">&amp;</span> <span class="va">conductivity</span> <span class="op">&lt;=</span> <span class="fl">1499</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>    <span class="va">conductivity</span> <span class="op">&gt;</span> <span class="fl">1499</span> <span class="op">&amp;</span> <span class="va">conductivity</span> <span class="op">&lt;=</span> <span class="fl">3000</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>You’ll start to notice that a lot of the output is <code>NA</code>.
This is due to the lack of data across our domain for these water
quality measurements. It will not be counted with the current model but
a future model might look into some sort of regularization or prior to
help with the missing data.</p>
<p>All we need to do now is calculate the stream temperature cutoffs and
then bring everything back to waterbodies and flowlines.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream_temp_id</span> <span class="op">&lt;-</span> <span class="va">stream_temp_id</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>temperature_water <span class="op">=</span> <span class="st">'S2_02_11'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    temperature_water <span class="op">=</span> <span class="op">(</span><span class="va">temperature_water</span><span class="op">*</span><span class="fl">9</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">32</span>, </span>
<span>    temperature_model <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">40</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">40</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">46</span><span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">46</span><span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">56</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">56</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">71</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">71</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">75</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">75</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">83</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">83</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">120</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>comid <span class="op">=</span> <span class="st">'COMID'</span>, temperature <span class="op">=</span> <span class="st">'temperature_water'</span>, <span class="va">temperature_model</span><span class="op">)</span></span></code></pre></div>
<p>Bring in the previously created datasets
<code>nhdplus_idaho_final_social</code> and
<code>waterbodies_idaho_final_social</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhdplus_idaho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">'data/simple_features.gpkg'</span>, layer <span class="op">=</span> <span class="st">'nhdplus_idaho_final_social'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">waterbodies_idaho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">'data/simple_features.gpkg'</span>, layer <span class="op">=</span> <span class="st">'waterbodies_idaho_final_social'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nhdplus_idaho_final_together</span> <span class="op">&lt;-</span> <span class="va">nhdplus_idaho</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">comid</span>, <span class="va">huc12</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'waterbody_'</span><span class="op">)</span>, <span class="va">mussel_proximity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">final_ish_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stream_temp_id</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">comid</span>, <span class="va">temperature</span>, <span class="va">temperature_model</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># now for the special case waterbodies</span></span>
<span><span class="co"># bc NA's for all stream_temp_id</span></span>
<span></span>
<span><span class="va">wb_temp_list</span> <span class="op">&lt;-</span> <span class="va">monitorings_sites_quagga_zebra_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">waterbodies_idaho</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wb_temp_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">wb_temp_list</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">stream_temp_wb</span> <span class="op">&lt;-</span> <span class="va">monitorings_sites_quagga_zebra_sf</span><span class="op">[</span><span class="va">wb_temp_list</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">stream_temp_wb</span> <span class="op">&lt;-</span> <span class="va">stream_temp_wb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">waterbodies_idaho</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">stream_temp_wb</span> <span class="op">&lt;-</span> <span class="va">stream_temp_wb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>temperature_water <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">temperature_water</span> <span class="op">&lt;</span> <span class="fl">32</span>, <span class="op">(</span><span class="va">temperature_water</span><span class="op">*</span><span class="fl">9</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">32</span>, <span class="va">temperature_water</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">comid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>temperature_water <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">temperature_water</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> </span>
<span>    temperature_model <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">40</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">40</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">46</span><span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">46</span><span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">56</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">56</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">71</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">71</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">75</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">75</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">83</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">temperature_water</span> <span class="op">&gt;</span> <span class="fl">83</span> <span class="op">&amp;</span> <span class="va">temperature_water</span> <span class="op">&lt;=</span> <span class="fl">120</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">comid</span>, temperature <span class="op">=</span> <span class="st">'temperature_water'</span>, <span class="va">temperature_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">waterbodies_idaho_final_together</span> <span class="op">&lt;-</span> <span class="va">waterbodies_idaho</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">comid</span>, <span class="va">huc12</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'waterbody_'</span><span class="op">)</span>, <span class="va">mussel_proximity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">final_ish_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stream_temp_wb</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf</a></span><span class="op">(</span><span class="va">nhdplus_idaho_final_together</span>, <span class="st">'data/simple_features.gpkg'</span>, layer <span class="op">=</span> <span class="st">'nhdplus_idaho_final_together'</span>, delete_layer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf</a></span><span class="op">(</span><span class="va">waterbodies_idaho_final_together</span>, <span class="st">'data/simple_features.gpkg'</span>, layer <span class="op">=</span> <span class="st">'waterbodies_idaho_final_together'</span>, delete_layer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Isaak DJ, Wenger SJ, Peterson EE, Ver Hoef JM, Nagel DE, Luce CH,
Hostetler SW, Dunham JB, Roper BB, Wollrab SP, others (2017). “The
NorWeST summer stream temperature model and scenarios for the western
US: A crowd-sourced database and new geospatial tools foster a user
community and predict broad climate warming of rivers and streams.”
Water Resources Research, 53(11), 9181–9205.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="wrapper">

    <h2 class="footer-heading"></h2>

    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
